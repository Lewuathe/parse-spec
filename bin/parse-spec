#!/usr/bin/env bash

PROGNAME=$(basename $0)
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

print_usage() {
  echo "Usage: $0"
  echo "  trace  : Trace both API"
  echo "  verify : Verify Migrated APIs"
  echo "  Options:"
  echo "    -c <Config JSON>"
  echo "    -b <Build Dir>"
}

if [ $# -eq 0 ]; then
  print_usage
fi

CONFIG_FILE=./config/api.json
BUILD_DIR=./build/

for OPT in "$@"
do
    case "$OPT" in
        '-h'|'--help' )
            print_usage
            exit 1
            ;;
        '-c'|'--config' )
            CONFIG_FILE="$2"
            shift 2
            ;;
        '-b'|'--build' )
            BUILD_DIR=$2
            shift 2
            ;;
        -*)
            echo "$PROGNAME: illegal option -- '$(echo $1 | sed 's/^-*//')'" 1>&2
            exit 1
            ;;
        *)
            ;;
    esac
done

trace_api() {
  rm -rf $BUILD_DIR
  mkdir -p $BUILD_DIR
  NODE_HOME=`which node`/../../lib/node_modules
  `which node` $NODE_HOME/parse-spec/lib/trace.js $CONFIG_FILE $BUILD_DIR
}

verify_api() {
  NODE_HOME=`which node`/../../lib/node_modules
  `which node` $NODE_HOME/parse-spec/lib/verify.js $CONFIG_FILE $BUILD_DIR
}

case $1 in
    trace) trace_api
        ;;
    verify) verify_api
        ;;
esac

exit 0